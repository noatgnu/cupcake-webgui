<div class="modal-header">
  <h5 class="modal-title">
    <i class="bi bi-shield-lock me-2"></i>
    Manage Permissions - {{ labGroup.name }}
  </h5>
  <button type="button" class="btn-close" (click)="close()" [disabled]="saving()"></button>
</div>

<div class="modal-body">
  @if (loading()) {
    <div class="text-center p-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  } @else if (members().length === 0) {
    <div class="alert alert-info">
      <i class="bi bi-info-circle me-2"></i>
      No members found in this lab group
    </div>
  } @else {
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Member</th>
            <th class="text-center">View</th>
            <th class="text-center">Invite</th>
            <th class="text-center">Manage</th>
            @if (isStaff()) {
              <th class="text-center">Process Jobs</th>
            }
          </tr>
        </thead>
        <tbody>
          @for (memberWithPermission of members(); track memberWithPermission.member.id) {
            <tr>
              <td>
                <div>
                  <div class="fw-semibold">
                    @if (memberWithPermission.member.firstName || memberWithPermission.member.lastName) {
                      {{ memberWithPermission.member.firstName }} {{ memberWithPermission.member.lastName }}
                    } @else {
                      {{ memberWithPermission.member.username }}
                    }
                  </div>
                  @if (memberWithPermission.member.email) {
                    <small class="text-muted">{{ memberWithPermission.member.email }}</small>
                  }
                </div>
              </td>
              <td class="text-center">
                <div class="form-check d-inline-block">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    [(ngModel)]="memberWithPermission.canView"
                    [disabled]="saving()">
                </div>
              </td>
              <td class="text-center">
                <div class="form-check d-inline-block">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    [(ngModel)]="memberWithPermission.canInvite"
                    [disabled]="saving()">
                </div>
              </td>
              <td class="text-center">
                <div class="form-check d-inline-block">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    [(ngModel)]="memberWithPermission.canManage"
                    [disabled]="saving()">
                </div>
              </td>
              @if (isStaff()) {
                <td class="text-center">
                  <div class="form-check d-inline-block">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      [(ngModel)]="memberWithPermission.canProcessJobs"
                      [disabled]="saving()">
                  </div>
                </td>
              }
            </tr>
          }
        </tbody>
      </table>
    </div>
    <div class="alert alert-info mb-0">
      <small>
        <strong>Permission levels:</strong>
        <ul class="mb-0">
          <li><strong>View:</strong> Can view lab group details and members</li>
          <li><strong>Invite:</strong> Can invite new members to the lab group</li>
          <li><strong>Manage:</strong> Can modify lab group settings and manage permissions</li>
          @if (isStaff()) {
            <li><strong>Process Jobs:</strong> Can process and execute jobs for this lab group</li>
          }
        </ul>
      </small>
    </div>
  }
</div>

<div class="modal-footer">
  <button type="button" class="btn btn-secondary" (click)="close()" [disabled]="saving()">
    Cancel
  </button>
  <button type="button" class="btn btn-primary" (click)="save()" [disabled]="loading() || saving()">
    @if (saving()) {
      <span class="spinner-border spinner-border-sm me-2"></span>
    }
    Save Permissions
  </button>
</div>
