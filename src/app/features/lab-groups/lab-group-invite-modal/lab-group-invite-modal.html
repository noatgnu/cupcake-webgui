<div class="modal-header">
  <h5 class="modal-title">
    <i class="bi bi-person-plus me-2"></i>
    {{ isStaff ? 'Add Member' : 'Invite Member' }}
  </h5>
  <button type="button" class="btn-close" (click)="close()" [disabled]="saving()"></button>
</div>

<div class="modal-body">
  <div class="mb-3">
    <label for="search" class="form-label">Search Users</label>
    <input
      type="search"
      class="form-control"
      id="search"
      [(ngModel)]="searchQuery"
      (ngModelChange)="onSearchChange()"
      placeholder="Search by username or email..."
      [disabled]="saving()">
  </div>

  @if (loading()) {
    <div class="text-center p-3">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  } @else if (users().length === 0) {
    <div class="alert alert-info">
      <i class="bi bi-info-circle me-2"></i>
      No users found
    </div>
  } @else {
    <div class="mb-3">
      <label class="form-label">Select User</label>
      <div class="list-group" style="max-height: 300px; overflow-y: auto;">
        @for (user of users(); track user.id) {
          <label class="list-group-item list-group-item-action" [class.active]="selectedUser?.id === user.id">
            <input
              class="form-check-input me-2"
              type="radio"
              name="selectedUser"
              [value]="user"
              [(ngModel)]="selectedUser"
              [disabled]="saving()">
            <div class="d-inline-block">
              <div class="fw-semibold">{{ getUserDisplayName(user) }}</div>
              @if (user.email) {
                <small class="text-muted">{{ user.email }}</small>
              }
            </div>
          </label>
        }
      </div>
    </div>
  }

  @if (isStaff) {
    <div class="alert alert-info mb-0">
      <i class="bi bi-info-circle me-2"></i>
      <small>As a staff member, you can directly add users to the lab group without requiring invitation acceptance.</small>
    </div>
  }
</div>

<div class="modal-footer">
  <button type="button" class="btn btn-secondary" (click)="close()" [disabled]="saving()">
    Cancel
  </button>
  <button
    type="button"
    class="btn btn-primary"
    (click)="inviteOrAddUser()"
    [disabled]="!selectedUser || saving() || loading()">
    @if (saving()) {
      <span class="spinner-border spinner-border-sm me-2"></span>
    }
    {{ isStaff ? 'Add Member' : 'Send Invitation' }}
  </button>
</div>
