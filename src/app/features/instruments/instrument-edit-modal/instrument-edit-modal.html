<div class="modal-header">
  <h5 class="modal-title">
    <i class="bi bi-gear me-2"></i>
    {{ isEdit ? 'Edit' : 'New' }} Instrument
  </h5>
  <button type="button" class="btn-close" (click)="cancel()" aria-label="Close"></button>
</div>

<div class="modal-body">
  <form>
    <div class="mb-3">
      <label for="instrumentName" class="form-label">Instrument Name <span class="text-danger">*</span></label>
      <input
        type="text"
        class="form-control"
        id="instrumentName"
        [(ngModel)]="instrumentName"
        name="instrumentName"
        placeholder="Enter instrument name"
        required>
    </div>

    <div class="mb-3">
      <label for="instrumentDescription" class="form-label">Description</label>
      <textarea
        class="form-control"
        id="instrumentDescription"
        [(ngModel)]="instrumentDescription"
        name="instrumentDescription"
        placeholder="Enter instrument description"
        rows="3"></textarea>
    </div>

    <div class="mb-3">
      <label for="instrumentImage" class="form-label">Image</label>

      @if (imagePreview() || currentImageUrl()) {
        <div class="mb-2">
          <div class="position-relative d-inline-block">
            <img
              [src]="imagePreview() || currentImageUrl()!"
              alt="Instrument preview"
              class="img-thumbnail"
              style="max-height: 200px; max-width: 100%;">
            <button
              type="button"
              class="btn btn-sm btn-danger position-absolute top-0 end-0 m-1"
              (click)="removeImage()"
              title="Remove image">
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
        </div>
      }

      <input
        type="file"
        class="form-control"
        id="instrumentImage"
        (change)="onImageSelected($event)"
        accept="image/*">
      <small class="form-text text-muted">Maximum file size: 10MB. Supported formats: JPG, PNG, GIF, WebP</small>
    </div>

    <div class="row">
      <div class="col-md-6 mb-3">
        <div class="form-check form-switch">
          <input
            class="form-check-input"
            type="checkbox"
            id="enabled"
            [(ngModel)]="enabled"
            name="enabled">
          <label class="form-check-label" for="enabled">
            <i class="bi bi-check-circle me-1"></i>
            Enabled
          </label>
        </div>
      </div>

      <div class="col-md-6 mb-3">
        <div class="form-check form-switch">
          <input
            class="form-check-input"
            type="checkbox"
            id="acceptsBookings"
            [(ngModel)]="acceptsBookings"
            name="acceptsBookings">
          <label class="form-check-label" for="acceptsBookings">
            <i class="bi bi-calendar-check me-1"></i>
            Accepts Bookings
          </label>
        </div>
      </div>
    </div>

    @if (acceptsBookings) {
      <div class="row">
        <div class="col-md-12 mb-3">
          <div class="form-check form-switch">
            <input
              class="form-check-input"
              type="checkbox"
              id="allowOverlappingBookings"
              [(ngModel)]="allowOverlappingBookings"
              name="allowOverlappingBookings">
            <label class="form-check-label" for="allowOverlappingBookings">
              <i class="bi bi-calendar-range me-1"></i>
              Allow Overlapping Bookings
            </label>
          </div>
          <small class="form-text text-muted ms-4">When enabled, multiple users can book this instrument for overlapping time periods</small>
        </div>
      </div>
    }

    <hr class="my-4">

    <h6 class="text-muted mb-3">
      <i class="bi bi-clock-history me-2"></i>Pre-Approval Settings
    </h6>

    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="maxDaysAheadPreApproval" class="form-label">Max Days Ahead (Pre-Approval)</label>
        <input
          type="number"
          class="form-control"
          id="maxDaysAheadPreApproval"
          [(ngModel)]="maxDaysAheadPreApproval"
          name="maxDaysAheadPreApproval"
          placeholder="Enter days"
          min="0">
        <small class="form-text text-muted">Maximum days ahead for pre-approval bookings</small>
      </div>

      <div class="col-md-6 mb-3">
        <label for="maxDaysWithinUsagePreApproval" class="form-label">Max Days Within Usage (Pre-Approval)</label>
        <input
          type="number"
          class="form-control"
          id="maxDaysWithinUsagePreApproval"
          [(ngModel)]="maxDaysWithinUsagePreApproval"
          name="maxDaysWithinUsagePreApproval"
          placeholder="Enter days"
          min="0">
        <small class="form-text text-muted">Maximum days within usage for pre-approval</small>
      </div>
    </div>

    <hr class="my-4">

    <h6 class="text-muted mb-3">
      <i class="bi bi-bell me-2"></i>Notification Settings
    </h6>

    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="daysBeforeWarrantyNotification" class="form-label">Warranty Notification (Days Before)</label>
        <input
          type="number"
          class="form-control"
          id="daysBeforeWarrantyNotification"
          [(ngModel)]="daysBeforeWarrantyNotification"
          name="daysBeforeWarrantyNotification"
          placeholder="Enter days"
          min="0">
        <small class="form-text text-muted">Days before warranty expiration to notify</small>
      </div>

      <div class="col-md-6 mb-3">
        <label for="daysBeforeMaintenanceNotification" class="form-label">Maintenance Notification (Days Before)</label>
        <input
          type="number"
          class="form-control"
          id="daysBeforeMaintenanceNotification"
          [(ngModel)]="daysBeforeMaintenanceNotification"
          name="daysBeforeMaintenanceNotification"
          placeholder="Enter days"
          min="0">
        <small class="form-text text-muted">Days before maintenance is due to notify</small>
      </div>
    </div>
  </form>
</div>

<div class="modal-footer">
  <button type="button" class="btn btn-outline-secondary" (click)="cancel()" [disabled]="saving()">
    Cancel
  </button>
  <button type="button" class="btn btn-primary" (click)="save()" [disabled]="saving()">
    @if (saving()) {
      <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
    }
    <i class="bi bi-check-circle me-2"></i>
    {{ isEdit ? 'Update' : 'Create' }}
  </button>
</div>
