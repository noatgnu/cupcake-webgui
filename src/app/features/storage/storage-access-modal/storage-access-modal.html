<div class="modal-header">
  <h5 class="modal-title">
    <i class="bi bi-shield-lock me-2"></i>
    Manage Access Permissions
  </h5>
  <button type="button" class="btn-close" (click)="cancel()"></button>
</div>

<div class="modal-body">
  <p class="text-muted mb-3">
    Select which lab groups can access <strong>{{ storageObject.objectName }}</strong>
  </p>

  @if (loading()) {
    <div class="text-center p-4">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  } @else if (allLabGroups().length === 0) {
    <div class="alert alert-info">
      <i class="bi bi-info-circle me-2"></i>
      No lab groups available
    </div>
  } @else {
    <div class="list-group">
      @for (labGroup of allLabGroups(); track labGroup.id) {
        <label class="list-group-item d-flex align-items-center">
          <input
            type="checkbox"
            class="form-check-input me-3"
            [checked]="isSelected(labGroup.id)"
            (change)="toggleLabGroup(labGroup.id)">
          <div class="flex-grow-1">
            <div class="fw-semibold">{{ labGroup.name }}</div>
            @if (labGroup.description) {
              <small class="text-muted">{{ labGroup.description }}</small>
            }
          </div>
        </label>
      }
    </div>

    @if (total() > pageSize) {
      <div class="mt-3">
        <nav>
          <ul class="pagination pagination-sm mb-0 justify-content-center">
            <li class="page-item" [class.disabled]="page() === 1">
              <button class="page-link" (click)="previousPage()">Previous</button>
            </li>
            <li class="page-item disabled">
              <span class="page-link">{{ page() }} / {{ Math.ceil(total() / pageSize) }}</span>
            </li>
            <li class="page-item" [class.disabled]="page() >= Math.ceil(total() / pageSize)">
              <button class="page-link" (click)="nextPage()">Next</button>
            </li>
          </ul>
        </nav>
      </div>
    }
  }
</div>

<div class="modal-footer">
  <button type="button" class="btn btn-secondary" (click)="cancel()" [disabled]="saving()">
    Cancel
  </button>
  <button type="button" class="btn btn-primary" (click)="save()" [disabled]="saving() || loading()">
    @if (saving()) {
      <span class="spinner-border spinner-border-sm me-2"></span>
    }
    Save Changes
  </button>
</div>
