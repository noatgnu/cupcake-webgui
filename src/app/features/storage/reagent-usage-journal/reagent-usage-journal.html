<div class="reagent-usage-journal">
  <div class="header mb-3">
    <h6 class="mb-0">
      <i class="bi bi-journal-text me-2"></i>
      Usage Journal
      <span class="badge bg-secondary ms-2">{{ total() }} entries</span>
    </h6>
  </div>

  @if (loading()) {
    <div class="text-center p-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  } @else if (actions().length === 0) {
    <div class="text-center p-5 text-muted">
      <i class="bi bi-journal display-4 mb-3 d-block opacity-25"></i>
      <p class="lead">No usage history</p>
      <p class="small">Actions will appear here when quantities are added or reserved</p>
    </div>
  } @else {
    <div class="timeline">
      @for (action of actions(); track action.id; let idx = $index) {
        <div class="timeline-item">
          <div class="timeline-marker">
            <i [class]="getActionIcon(action.actionType) + ' ' + getActionClass(action.actionType)"></i>
          </div>
          <div class="timeline-content card">
            <div class="card-body p-3">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <div class="flex-grow-1">
                  <div class="d-flex align-items-center gap-2 mb-1">
                    <span [class]="'badge ' + getActionBadgeClass(action.actionType)">
                      {{ action.actionTypeDisplay || action.actionType }}
                    </span>
                    <strong class="quantity">
                      {{ action.actionType === ActionType.ADD ? '+' : '-' }}{{ action.quantity }}
                      @if (reagentUnit) {
                        <span class="text-muted">{{ reagentUnit }}</span>
                      }
                    </strong>
                  </div>
                  @if (action.notes) {
                    <p class="small mb-2">{{ action.notes }}</p>
                  }
                  <div class="d-flex gap-3 small text-muted">
                    <span>
                      <i class="bi bi-person me-1"></i>
                      {{ action.userUsername || 'Unknown user' }}
                    </span>
                    <span>
                      <i class="bi bi-clock me-1"></i>
                      {{ getTimeAgo(action.createdAt) }}
                    </span>
                  </div>
                  <div class="small text-muted mt-1">
                    {{ formatDate(action.createdAt) }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      }
    </div>

    @if (total() > pageSize) {
      <div class="mt-3">
        <nav>
          <ul class="pagination pagination-sm justify-content-center">
            <li class="page-item" [class.disabled]="page() === 1">
              <button class="page-link" (click)="previousPage()">Previous</button>
            </li>
            <li class="page-item disabled">
              <span class="page-link">
                Page {{ page() }} of {{ Math.ceil(total() / pageSize) }}
              </span>
            </li>
            <li class="page-item" [class.disabled]="page() * pageSize >= total()">
              <button class="page-link" (click)="nextPage()">Next</button>
            </li>
          </ul>
        </nav>
      </div>
    }
  }
</div>
