<div class="notifications-view h-100 d-flex flex-column">
  <!-- Header Section -->
  <nav class="navbar navbar-expand-lg bg-body-tertiary shadow-sm">
    <div class="container-fluid">
      <div class="d-flex align-items-center justify-content-between w-100 flex-wrap gap-3">
        <h4 class="navbar-brand m-0 fw-bold">
          <i class="bi bi-bell me-2"></i>Notifications
        </h4>
        <div class="d-flex gap-2 align-items-center flex-wrap">
          <select class="form-select form-select-sm" style="width: auto;" [(ngModel)]="filterType" (change)="applyFilters()">
            <option value="">All Types</option>
            @for (type of notificationTypes; track type) {
              <option [value]="type">{{ type }}</option>
            }
          </select>
          <select class="form-select form-select-sm" style="width: auto;" [(ngModel)]="filterPriority" (change)="applyFilters()">
            <option value="">All Priorities</option>
            @for (priority of notificationPriorities; track priority) {
              <option [value]="priority">{{ priority }}</option>
            }
          </select>
          <select class="form-select form-select-sm" style="width: auto;" [(ngModel)]="filterIsRead" (change)="applyFilters()">
            <option value="">All</option>
            <option value="false">Unread</option>
            <option value="true">Read</option>
          </select>
          <button class="btn btn-sm btn-outline-secondary" (click)="clearFilters()">
            <i class="bi bi-x-circle me-1"></i>Clear Filters
          </button>
          <button class="btn btn-sm btn-primary" (click)="markAllAsRead()">
            <i class="bi bi-check-all me-1"></i>Mark All as Read
          </button>
        </div>
      </div>
    </div>
  </nav>

  <div class="content flex-grow-1 overflow-auto">
    @if (loading()) {
      <div class="text-center p-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    } @else if (notifications().length === 0) {
      <div class="text-center p-5 text-muted">
        <i class="bi bi-bell-slash display-1 mb-3 d-block"></i>
        <p class="lead">No notifications found</p>
      </div>
    } @else {
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead>
            <tr>
              <th style="width: 40px;"></th>
              <th>Notification</th>
              <th style="width: 120px;">Priority</th>
              <th style="width: 150px;">Type</th>
              <th style="width: 150px;">Time</th>
              <th style="width: 150px;">Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (notification of notifications(); track notification.id) {
              <tr [class.table-primary]="!notification.isRead">
                <td class="text-center">
                  <i [class]="getPriorityIcon(notification.priority) + ' ' + getPriorityClass(notification.priority)"></i>
                </td>
                <td>
                  <div class="fw-semibold">{{ notification.title }}</div>
                  <div class="text-muted small">{{ notification.message }}</div>
                  @if (notification.senderName) {
                    <div class="text-muted small mt-1">
                      <i class="bi bi-person me-1"></i>
                      From: {{ notification.senderName }}
                    </div>
                  }
                </td>
                <td>
                  <span [class]="'badge ' + getPriorityBadgeClass(notification.priority)">
                    {{ notification.priority }}
                  </span>
                </td>
                <td>
                  <span class="badge bg-secondary">
                    {{ notification.notificationType }}
                  </span>
                </td>
                <td>
                  <small class="text-muted">
                    {{ getTimeAgo(notification.createdAt) }}
                  </small>
                </td>
                <td>
                  <div class="d-flex gap-1 flex-wrap">
                    @if (!notification.isRead) {
                      <button
                        class="btn btn-sm btn-outline-primary"
                        (click)="markAsRead(notification)"
                        title="Mark as read">
                        <i class="bi bi-check"></i>
                      </button>
                    }
                    @if (hasReagentLink(notification)) {
                      <button
                        class="btn btn-sm btn-outline-primary"
                        (click)="navigateToReagent(notification)"
                        title="View reagent">
                        <i class="bi bi-box-arrow-up-right"></i>
                      </button>
                    }
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
  </div>

  @if (total() > pageSize) {
    <div class="footer p-3 border-top">
      <nav>
        <ul class="pagination pagination-sm mb-0 justify-content-center">
          <li class="page-item" [class.disabled]="page() === 1">
            <button class="page-link" (click)="previousPage()">Previous</button>
          </li>
          <li class="page-item disabled">
            <span class="page-link">
              Page {{ page() }} of {{ Math.ceil(total() / pageSize) }}
              ({{ total() }} total)
            </span>
          </li>
          <li class="page-item" [class.disabled]="page() * pageSize >= total()">
            <button class="page-link" (click)="nextPage()">Next</button>
          </li>
        </ul>
      </nav>
    </div>
  }
</div>
