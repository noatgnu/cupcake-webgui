<div class="storage-location-typeahead position-relative">
  <div class="input-group">
    <input
      type="text"
      class="form-control"
      [placeholder]="placeholder"
      [value]="searchTerm()"
      (input)="onSearchChange($any($event.target).value)"
      (focus)="showDropdown.set(results().length > 0)"
      (blur)="closeDropdown()"
      autocomplete="off">
    @if (searchTerm()) {
      <button
        class="btn btn-outline-secondary"
        type="button"
        (click)="clearSelection()"
        title="Clear selection">
        <i class="bi bi-x-lg"></i>
      </button>
    }
  </div>

  @if (loading()) {
    <div class="dropdown-menu show w-100 mt-1">
      <div class="dropdown-item text-center">
        <div class="spinner-border spinner-border-sm text-primary" role="status">
          <span class="visually-hidden">Searching...</span>
        </div>
        <span class="ms-2">Searching...</span>
      </div>
    </div>
  } @else if (showDropdown() && results().length > 0) {
    <div class="dropdown-menu show w-100 mt-1">
      @for (location of results(); track location.id) {
        <div
          class="dropdown-item location-item"
          role="button"
          (mousedown)="selectLocation(location)">
          <div class="d-flex align-items-start">
            <i class="bi bi-geo-alt-fill me-2 text-primary mt-1"></i>
            <div class="flex-grow-1">
              <div class="fw-semibold">{{ location.objectName }}</div>
              @if (location.fullPath && location.fullPath.length > 0) {
                <div class="breadcrumb-path text-muted small">
                  <i class="bi bi-chevron-right me-1"></i>
                  {{ getPathString(location) }}
                </div>
              }
            </div>
          </div>
        </div>
      }
    </div>
  } @else if (showDropdown() && searchTerm() && searchTerm().length >= 2 && results().length === 0) {
    <div class="dropdown-menu show w-100 mt-1">
      <div class="dropdown-item text-muted text-center">
        <i class="bi bi-search me-2"></i>
        No locations found
      </div>
    </div>
  }
</div>
